# 管理后台端开发方案

## 开发进度规划
✅ 已完成：
- 项目初始化和基础架构
- 用户管理模块
- 订单管理模块
- 套餐管理模块
- 支付管理模块
- 时间槽管理模块

🚀 待开发：
- 查找功能模块
- 权限管理和安全机制
- 系统设置和日志管理

## 1. 技术选型
- React 18 + TypeScript
- UI组件库：Ant Design Pro
- 路由管理：React Router
- 状态管理：Redux Toolkit 
- 网络请求：axios，统一API服务层
- 构建工具：Vite
- 数据可视化：ECharts/Recharts
- 表格组件：Ant Design Table
- 表单验证：Ant Design Form + Yup
- 日期处理：dayjs

## 2. 目录结构建议
```
admin-frontend/
├── src/
│   ├── pages/
│   │   ├── Dashboard/     # 仪表盘/统计概览 ✅
│   │   ├── Users/         # 用户管理 ✅
│   │   │   ├── UserList.tsx
│   │   │   ├── UserDetail.tsx
│   │   │   └── UserForm.tsx
│   │   ├── Orders/        # 订单管理 ✅
│   │   │   ├── OrderList.tsx
│   │   │   ├── OrderDetail.tsx
│   │   │   └── OrderForm.tsx
│   │   ├── Packages/      # 套餐管理 ✅
│   │   │   ├── PackageList.tsx
│   │   │   ├── PackageDetail.tsx
│   │   │   └── PackageForm.tsx
│   │   ├── Payments/      # 支付管理 ✅
│   │   │   ├── PaymentList.tsx
│   │   │   └── PaymentDetail.tsx
│   │   ├── TimeSlots/     # 时间槽管理 ✅
│   │   │   ├── TimeSlotList.tsx
│   │   │   ├── TimeSlotForm.tsx
│   │   │   └── BatchCreate.tsx
│   │   ├── Search/        # 查找功能 🚀
│   │   │   └── GlobalSearch.tsx
│   │   ├── System/        # 系统管理 🚀
│   │   │   ├── Settings.tsx
│   │   │   └── Logs.tsx
│   │   └── Auth/          # 认证相关 ✅
│   │       ├── Login.tsx
│   │       └── Register.tsx
│   ├── components/        # 公共组件 ✅
│   │   ├── Layout/        # 布局组件
│   │   ├── Charts/        # 图表组件
│   │   ├── SearchForm/    # 搜索表单
│   │   ├── DataTable/     # 数据表格
│   │   ├── StatusTag/     # 状态标签
│   │   └── ExportButton/  # 导出按钮
│   ├── services/          # API请求封装 ✅
│   │   ├── api.ts         # 通用API配置
│   │   ├── users.ts       # 用户相关API
│   │   ├── orders.ts      # 订单相关API
│   │   ├── packages.ts    # 套餐相关API
│   │   ├── payments.ts    # 支付相关API
│   │   ├── timeSlots.ts   # 时间槽相关API
│   │   └── auth.ts        # 认证相关API
│   ├── utils/             # 工具函数 🚀
│   │   ├── constants.ts   # 常量定义
│   │   ├── helpers.ts     # 辅助函数
│   │   ├── validators.ts  # 验证函数
│   │   └── export.ts      # 导出功能
│   ├── store/             # 状态管理 ✅
│   │   ├── index.ts       # Store配置
│   │   ├── authSlice.ts   # 认证状态
│   │   ├── userSlice.ts   # 用户状态
│   │   └── orderSlice.ts  # 订单状态
│   ├── hooks/             # 自定义Hooks 🚀
│   │   ├── useAuth.ts     # 认证Hook
│   │   ├── useTable.ts    # 表格Hook
│   │   └── useExport.ts   # 导出Hook
│   ├── types/             # TypeScript类型定义 ✅
│   │   ├── user.ts        # 用户类型
│   │   ├── order.ts       # 订单类型
│   │   ├── package.ts     # 套餐类型
│   │   ├── payment.ts     # 支付类型 ✅
│   │   ├── timeSlot.ts    # 时间槽类型 ✅
│   │   └── common.ts      # 通用类型
│   ├── styles/            # 样式文件 ✅
│   │   ├── global.css     # 全局样式
│   │   └── variables.css  # CSS变量
│   └── app.tsx
├── public/
├── package.json ✅
├── vite.config.ts ✅
├── tsconfig.json ✅
└── README.md
```

## 3. 核心页面与功能说明

### 3.0 仪表盘（Dashboard）
- 系统概览：用户数量、订单统计、收入统计
- 图表展示：订单趋势、套餐销量、支付状态分布
- 快捷操作：快速查找、待处理订单、异常提醒

### 3.1 用户管理（Users）
- 用户列表：分页展示、多条件筛选、排序
- 用户详情：基本信息、订单历史、支付记录
- 用户编辑：信息修改、状态管理、权限设置
- 搜索功能：支持手机号、昵称、微信号模糊搜索
- 批量操作：批量启用/禁用、批量导出
- 数据统计：用户增长趋势、活跃度分析

### 3.2 订单管理（Orders）
- 订单列表：分页展示、状态筛选、时间范围筛选
- 多条件筛选：手机号、订单号、状态、时间区间、套餐名称
- 订单详情：完整订单信息、时间线展示、操作记录
- 状态管理：订单确认、取消、完成等状态流转
- 支付同步：支付状态更新、退款处理
- 批量操作：批量确认、批量取消、批量导出
- 统计分析：订单数量趋势、转化率、平均订单价值

### 3.3 套餐管理（Packages）
- 套餐列表：分页展示、价格筛选、状态筛选
- 套餐创建：基本信息、价格设置、服务内容
- 套餐编辑：信息修改、价格调整、内容更新
- 状态管理：上架/下架、启用/禁用
- 销量统计：预订次数、收入统计、用户反馈
- 批量操作：批量上架、批量调价、批量导出
- 数据分析：热门套餐排行、价格分析、季节性趋势

### 3.4 支付管理（Payments）
- 支付记录：分页展示、状态筛选、时间筛选
- 筛选条件：订单号、手机号、支付方式、支付状态
- 支付详情：支付信息、交易记录、关联订单
- 状态流转：支付确认、退款处理、异常处理
- 对账功能：支付平台对账、差异处理
- 财务报表：收入统计、支付方式分析、退款统计
- 风控管理：异常交易检测、风险订单标记

### 3.5 时间槽管理（TimeSlots）
- 时间槽列表：按日期展示、状态筛选、预订状态
- 批量创建：日期范围选择、时间段设置、重复规则
- 单个编辑：时间调整、状态修改、容量设置
- 冲突检测：时间重叠检查、资源分配验证
- 利用率统计：预订率分析、空闲时段统计
- 日历视图：可视化展示、拖拽操作、快速编辑
- 自动化管理：智能排班、动态调整、节假日处理

### 3.6 查找功能（Search）
- 全局搜索：跨模块搜索、智能匹配、结果分类
- 高级搜索：多条件组合、精确匹配、模糊搜索
- 搜索历史：常用搜索、收藏夹、快速访问
- 结果展示：分页显示、排序选项、详情预览
- 数据导出：搜索结果导出、自定义字段、格式选择
- 权限控制：搜索权限、结果过滤、敏感信息保护

### 3.7 系统管理（System）
- 系统设置：基础配置、业务参数、功能开关
- 操作日志：用户操作记录、系统日志、审计追踪
- 权限管理：角色管理、权限分配、访问控制
- 数据备份：定期备份、恢复功能、数据迁移
- 系统监控：性能监控、异常告警、健康检查

## 4. API服务层设计

### 4.1 统一请求封装
```typescript
// src/services/api.ts
import axios from 'axios';
import { message } from 'antd';

const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL,
  timeout: 10000,
});

// 请求拦截器
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    message.error(error.message);
    return Promise.reject(error);
  }
);
```

### 4.2 分模块API定义
- 用户API：增删改查、搜索、统计
- 订单API：列表、详情、状态更新、统计
- 套餐API：管理操作、销量统计、分析
- 支付API：记录查询、状态更新、退款
- 时间槽API：批量操作、冲突检测、统计

## 5. 状态管理设计

### 5.1 Redux Toolkit配置
```typescript
// src/store/index.ts
import { configureStore } from '@reduxjs/toolkit';
import authSlice from './authSlice';
import userSlice from './userSlice';
import orderSlice from './orderSlice';

export const store = configureStore({
  reducer: {
    auth: authSlice,
    user: userSlice,
    order: orderSlice,
  },
});
```

### 5.2 状态结构设计
- 认证状态：用户信息、权限、token
- 业务状态：当前页面数据、筛选条件、分页信息
- UI状态：loading、modal、drawer等界面状态

## 6. 权限与安全

### 6.1 权限分级
- **超级管理员**：系统完全访问权限
- **影楼管理员**：业务数据管理权限
- **操作员**：基础查看和操作权限

### 6.2 安全措施
- JWT Token认证
- 路由权限控制
- 按钮级权限控制
- 数据权限过滤
- 操作日志记录
- 敏感信息脱敏

## 7. 性能与体验优化

### 7.1 性能优化
- 组件懒加载（React.lazy）
- 虚拟滚动（大数据表格）
- 防抖节流（搜索、筛选）
- 缓存策略（React Query）
- 代码分割（路由级别）

### 7.2 用户体验
- 响应式设计（移动端适配）
- 加载状态指示
- 错误边界处理
- 操作确认提示
- 快捷键支持
- 主题切换支持

## 8. 数据导出功能

### 8.1 导出格式
- Excel格式（.xlsx）
- CSV格式（.csv）
- PDF格式（报表）

### 8.2 导出特性
- 自定义字段选择
- 数据筛选导出
- 批量导出支持
- 导出进度提示
- 大数据分片导出

## 9. 开发规范

### 9.1 代码规范
- ESLint + Prettier配置
- TypeScript严格模式
- 组件命名规范
- 文件目录规范
- 注释规范

### 9.2 提交规范
- Git提交规范
- 代码审查流程
- 单元测试覆盖
- 文档同步更新

## 10. 部署与运维

### 10.1 构建配置
- 环境变量配置
- 打包优化
- CDN部署
- 缓存策略

### 10.2 监控告警
- 错误监控（Sentry）
- 性能监控
- 用户行为分析
- 异常告警

## 已完成功能模块说明

### ✅ 支付管理（Payments）
- 支付记录列表：完整的支付信息展示和管理
- 多条件筛选：支付状态、支付方式、时间范围等
- 支付详情：详细的交易信息和关联订单
- 退款处理：支持部分退款和全额退款
- 状态同步：与第三方支付平台状态同步
- 数据统计：交易额统计、成功率分析
- 对账功能：支持与支付平台对账

### ✅ 时间槽管理（TimeSlots）
- 双视图模式：列表视图和日历视图
- 批量创建：支持批量创建时间槽
- 容量管理：预订容量和利用率统计
- 状态管理：时间槽启用/禁用控制
- 价格倍数：支持节假日和特殊时段价格调整
- 日历展示：直观的日历界面显示可用性
- 冲突检测：时间重叠和资源冲突检查

### 技术特性
- 完整的 TypeScript 类型定义
- 响应式设计和移动端适配
- 统一的 API 服务层封装
- Redux Toolkit 状态管理
- Ant Design 组件库集成
- 数据导出和打印功能
- 权限控制和安全验证

### 下一步开发计划
1. 全局搜索功能模块
2. 系统设置和权限管理
3. 操作日志和审计追踪
4. 自定义 Hooks 和工具函数
5. 单元测试和文档完善
6. 性能优化和用户体验提升

---
管理后台端开发方案持续更新中，核心业务功能模块已基本完成。
